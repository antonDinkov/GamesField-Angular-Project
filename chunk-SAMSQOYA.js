import{a as c}from"./chunk-M6DMS4UB.js";import{a as m}from"./chunk-WJ5ZAXFD.js";import{c as d}from"./chunk-P6VS5ELV.js";import{$ as l,da as g,ha as p,ia as h,k as u,w as r,wa as o}from"./chunk-ZL2HHINX.js";var b=class n{constructor(t){this.httpClient=t;this.checkSession().subscribe({next:e=>{this._user.set(e),this._isLoggedIn.set(!0),e.lastPlayed&&this.gameService.getGameById(e.lastPlayed).subscribe(s=>{this.setLastPlayed(s.post._id,s.post.name)})},error:()=>{localStorage.removeItem("user"),this._user.set(null),this._isLoggedIn.set(!1)}})}_isLoggedIn=o(!1);isLoggedIn=this._isLoggedIn.asReadonly();lastPlayed$=new u(null);_user=o(null);user=this._user.asReadonly();apiUrl=m.apiUrl;gameService=h(c);register(t,e,s,i,f){return this.httpClient.post(`${this.apiUrl}/register`,{firstName:t,lastName:e,email:s,password:i,repass:f},{withCredentials:!0}).pipe(l(a=>{this._isLoggedIn.set(!0),this._user.set(a.user),localStorage.setItem("user",JSON.stringify(a.user))}),r(a=>a.user))}login(t,e){return this.httpClient.post(`${this.apiUrl}/login`,{email:t,password:e},{withCredentials:!0}).pipe(l(s=>{this._isLoggedIn.set(!0),this._user.set(s.user),localStorage.setItem("user",JSON.stringify(s.user)),s.user.lastPlayed?this.gameService.getGameById(s.user.lastPlayed).subscribe(i=>{this.setLastPlayed(i.post._id,i.post.name)}):this.lastPlayed$.next(null)}))}logout(){return this.httpClient.get(`${this.apiUrl}/logout`,{withCredentials:!0}).pipe(l(()=>{this._isLoggedIn.set(!1),this._user.set(null),localStorage.removeItem("user")}))}checkSession(){return this.httpClient.get(`${this.apiUrl}/me`,{withCredentials:!0}).pipe(r(t=>t.user))}updateUserInfo(t){return this.httpClient.put(`${this.apiUrl}/update/profile`,t,{withCredentials:!0}).pipe(r(e=>e.user))}removePicture(t){return this.httpClient.put(`${this.apiUrl}/update/profile/remove-picture`,{email:t},{withCredentials:!0}).pipe(r(e=>e.user))}setLastPlayed(t,e){this.lastPlayed$.next({id:t,name:e})}static \u0275fac=function(e){return new(e||n)(p(d))};static \u0275prov=g({token:n,factory:n.\u0275fac,providedIn:"root"})};export{b as a};
