import{a as h}from"./chunk-WJ5ZAXFD.js";import{c as p}from"./chunk-P6VS5ELV.js";import{$ as n,da as u,ha as g,k as o,w as r,wa as l}from"./chunk-ZL2HHINX.js";var m=class a{constructor(e){this.httpClient=e;this.checkSession().subscribe({next:t=>{this._user.set(t),this._isLoggedIn.set(!0)},error:()=>{localStorage.removeItem("user"),this._user.set(null),this._isLoggedIn.set(!1)}})}_isLoggedIn=l(!1);isLoggedIn=this._isLoggedIn.asReadonly();lastPlayed$=new o(null);_user=l(null);user=this._user.asReadonly();apiUrl=h.apiUrl;register(e,t,s,d,c){return this.httpClient.post(`${this.apiUrl}/register`,{firstName:e,lastName:t,email:s,password:d,repass:c},{withCredentials:!0}).pipe(n(i=>{this._isLoggedIn.set(!0),this._user.set(i.user),localStorage.setItem("user",JSON.stringify(i.user))}),r(i=>i.user))}login(e,t){return this.httpClient.post(`${this.apiUrl}/login`,{email:e,password:t},{withCredentials:!0}).pipe(n(s=>{this._isLoggedIn.set(!0),this._user.set(s.user),localStorage.setItem("user",JSON.stringify(s.user))}))}logout(){return this.httpClient.get(`${this.apiUrl}/logout`,{withCredentials:!0}).pipe(n(()=>{this._isLoggedIn.set(!1),this._user.set(null),localStorage.removeItem("user")}))}checkSession(){return this.httpClient.get(`${this.apiUrl}/me`,{withCredentials:!0}).pipe(r(e=>e.user))}updateUserInfo(e){return this.httpClient.put(`${this.apiUrl}/update/profile`,e,{withCredentials:!0}).pipe(r(t=>t.user))}removePicture(e){return this.httpClient.put(`${this.apiUrl}/update/profile/remove-picture`,{email:e},{withCredentials:!0}).pipe(r(t=>t.user))}setLastPlayed(e,t){this.lastPlayed$.next({id:e,name:t})}static \u0275fac=function(t){return new(t||a)(g(p))};static \u0275prov=u({token:a,factory:a.\u0275fac,providedIn:"root"})};export{m as a};
