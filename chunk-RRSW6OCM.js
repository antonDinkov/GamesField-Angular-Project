import{a as U,b as c,c as D,d as R,e as j,f as J,h as z,i as B,j as Z,k as $,l as H,m as Y}from"./chunk-PYUXPI64.js";import{a as K}from"./chunk-YCIQE62M.js";import"./chunk-WJ5ZAXFD.js";import{$ as l,A as n,C as T,D as q,L as f,M as g,Q as F,R as a,S as s,T as u,W as x,X as _,Z as d,_ as v,a as I,aa as h,b as M,c as y,f as b,g as O,m as k,ma as V,q as p,r as N,ra as L,s as P,wa as A,z as G}from"./chunk-H3MY5SLI.js";var w=class i{formBuilder=p(H);httpClient=p(L);CLOUD_NAME="dsqegonee";UPLOAD_PRESET="my_unsigned_preset";createProfileForm(){let r=localStorage.getItem("user"),e=r?JSON.parse(r):"",t=e.email,o=e.firstName,m=e.lastName,C=e.picture;return this.formBuilder.group({firstName:[o,[c.required,c.minLength(4)]],lastName:[m,[c.required,c.minLength(4)]],email:[t,[c.required,c.pattern(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)]],passwords:this.formBuilder.group({password:["",[c.required,c.minLength(5),c.pattern(/^[a-zA-Z0-9]+$/)]],repass:["",[c.required]]},{validators:this.passwordMatchValidator}),picture:[C]})}uploadPicture(r){let e=new FormData;return e.append("file",r),e.append("upload_preset",this.UPLOAD_PRESET),this.httpClient.post(`https://api.cloudinary.com/v1_1/${this.CLOUD_NAME}/image/upload`,e).pipe(O(t=>({url:t.secure_url,publicId:t.public_id})))}getNestedControl(r,e,t){return r.get(e)?.get(t)}passwordMatchValidator(r){let e=r.get("password"),t=r.get("repass");return!e||!t?null:e.value!==t.value?(t.setErrors({passwordMismatch:!0}),{passwordMismatch:!0}):(t.hasError("passwordMismatch")&&t.setErrors(null),null)}getControl(r,e){return r.get(e)}isControlInvalid(r,e){let t=this.getControl(r,e);return t?.invalid&&(t?.dirty||t?.touched)||!1}isNestedControlInvalid(r,e,t){let o=this.getNestedControl(r,e,t);return o?.invalid&&(o?.dirty||o?.touched)||!1}getFirstNameErrorMessage(r){let e=this.getControl(r,"firstName");return e?.errors?.required?"First name is required!":e?.errors?.minlength?"First Name should have at least 4 symbols!":""}getLastNameErrorMessage(r){let e=this.getControl(r,"lastName");return e?.errors?.required?"Last name is required!":e?.errors?.minlength?"Last Name should have at least 4 symbols!":""}getEmailErrorMessage(r){let e=this.getControl(r,"email");return e?.errors?.required?"Email is required!":e?.errors?.pattern?"Email should be a valid email address!":""}getPasswordErrorMessage(r,e=!1){let t=e?this.getNestedControl(r,"passwords","password"):this.getControl(r,"password");return t?.errors?.required?"Password is required!":t?.errors?.minlength?"Password should be at least 5 characters!":t?.errors?.pattern?"Password should contain only English letters and digits!":e&&r.get("passwords")?.errors?.passwordMismatch?"Passwords do not match!":""}getRePasswordErrorMessage(r){let e=this.getNestedControl(r,"passwords","repass"),t=r.get("passwords");return e?.errors?.required?"Repeat Password is required!":t?.errors?.passwordMismatch?"Passwords do not match!":""}markFormTouched(r){Object.keys(r.controls).forEach(e=>{let t=r.get(e);t instanceof j?Object.keys(t.controls).forEach(o=>{t.get(o)?.markAsTouched()}):t?.markAsTouched()})}isFormInvalid(r){return r.invalid}getProfileFormValue(r){let{firstName:e,lastName:t,email:o,picture:m}=r.value,{password:C,repass:S}=r.value.passwords;return{firstName:e,lastName:t,email:o,picture:m,password:C,repass:S}}static \u0275fac=function(e){return new(e||i)};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};function X(i,r){if(i&1&&(a(0,"p",5),l(1),s()),i&2){let e=d();n(),h(e.formService.getFirstNameErrorMessage(e.form))}}function ee(i,r){if(i&1&&(a(0,"p",5),l(1),s()),i&2){let e=d();n(),h(e.formService.getLastNameErrorMessage(e.form))}}function te(i,r){if(i&1&&(a(0,"p",5),l(1),s()),i&2){let e=d();n(),h(e.formService.getEmailErrorMessage(e.form))}}function re(i,r){if(i&1&&(a(0,"p",5),l(1),s()),i&2){let e=d();n(),h(e.formService.getPasswordErrorMessage(e.form,!0))}}function ie(i,r){if(i&1&&(a(0,"p",5),l(1),s()),i&2){let e=d();n(),h(e.formService.getRePasswordErrorMessage(e.form))}}function oe(i,r){if(i&1){let e=x();u(0,"img",20),a(1,"button",21),_("click",function(){N(e);let o=d();return P(o.removePicture())}),l(2,"Remove Picture"),s()}if(i&2){let e,t=d();F("src",(e=t.form.get("picture"))==null?null:e.value,G)}}function ne(i,r){if(i&1){let e=x();a(0,"input",22),_("change",function(o){N(e);let m=d();return P(m.onFileSelected(o))}),s()}}var Q=class i{constructor(r){this.location=r;this.form=this.formService.createProfileForm()}formService=p(w);authService=p(K);router=p(A);selectedFile=null;isUploading=!1;user;form;onFileSelected(r){let e=r.target.files?.[0];if(!e)return;let t=new FileReader;t.onload=()=>{this.form.get("picture")?.setValue(t.result)},t.readAsDataURL(e),this.selectedFile=e}removePicture(){this.form.get("picture")?.setValue(""),this.selectedFile=null;let r=localStorage.getItem("user");if(r){let e=JSON.parse(r);e.picture="",e.pictureId="",localStorage.setItem("user",JSON.stringify(e))}}onSubmit(){return y(this,null,function*(){if(this.isUploading){alert("Please wait until your picture has been uploaded");return}if(this.formService.isFormInvalid(this.form)){this.formService.markFormTouched(this.form);return}let r=localStorage.getItem("user");if(!r){alert("Your user information is missing, please contact support");return}let e=JSON.parse(r),t=e.email,o=this.form.get("picture")?.value;try{if(o||(yield b(this.authService.removePicture(t)),e.picture="",e.pictureId="",localStorage.setItem("user",JSON.stringify(e))),this.selectedFile){let E=yield b(this.formService.uploadPicture(this.selectedFile));this.form.get("picture")?.setValue(E.url),e.picture=E.url,e.pictureId=E.publicId,localStorage.setItem("user",JSON.stringify(e))}let m=this.formService.getProfileFormValue(this.form),C=M(I({},m),{oldEmail:t,pictureId:e.pictureId}),S=yield b(this.authService.updateUserInfo(C));this.user=S,localStorage.setItem("user",JSON.stringify(S)),this.router.navigate(["/profile"])}catch(m){console.error("Update failed:",m),this.formService.markFormTouched(this.form)}})}goBack(){this.location.back()}static \u0275fac=function(e){return new(e||i)(T(V))};static \u0275cmp=q({type:i,selectors:[["app-edit"]],decls:35,vars:17,consts:[["id","rightside"],[1,"edit-profile-card"],[1,"edit-profile-form",3,"ngSubmit","formGroup"],["for","firstName"],["type","text","id","firstName","formControlName","firstName","value","\u0418\u0432\u0430\u043D","required",""],[1,"error"],["for","lastName"],["type","text","id","lastName","formControlName","lastName","value","\u0418\u0432\u0430\u043D\u043E\u0432","required",""],["for","email"],["type","email","id","email","formControlName","email","value","ivan@example.com","required",""],["formGroupName","passwords",1,"edit-profile-form"],["for","password"],["type","password","id","password","formControlName","password"],["for","repass"],["type","password","id","repass","formControlName","repass"],["for","pictureFile"],["type","file","id","pictureFile","accept","image/*"],["type","hidden","formControlName","picture"],["type","submit"],[1,"back-button",3,"click"],["alt","Profile preview",1,"preview-img",3,"src"],["type","button",3,"click"],["type","file","id","pictureFile","accept","image/*",3,"change"]],template:function(e,t){if(e&1&&(a(0,"div",0)(1,"div",1)(2,"h1"),l(3,"Edit Profile"),s(),a(4,"form",2),_("ngSubmit",function(){return t.onSubmit()}),a(5,"label",3),l(6,"First name"),s(),u(7,"input",4),f(8,X,2,1,"p",5),a(9,"label",6),l(10,"Last Name"),s(),u(11,"input",7),f(12,ee,2,1,"p",5),a(13,"label",8),l(14,"Email"),s(),u(15,"input",9),f(16,te,2,1,"p",5),a(17,"div",10)(18,"label",11),l(19,"New Password"),s(),u(20,"input",12),f(21,re,2,1,"p",5),a(22,"label",13),l(23,"Repeat New Password"),s(),u(24,"input",14),f(25,ie,2,1,"p",5),s(),a(26,"label",15),l(27,"Profile Picture"),s(),f(28,oe,3,1)(29,ne,1,0,"input",16),u(30,"input",17),a(31,"button",18),l(32,"Save The Changes"),s(),a(33,"button",19),_("click",function(m){return t.goBack(),m.preventDefault()}),l(34,"CANCEL"),s()()()()),e&2){let o;n(4),F("formGroup",t.form),n(3),v("input-error",t.formService.isControlInvalid(t.form,"firstName")),n(),g(t.formService.isControlInvalid(t.form,"firstName")?8:-1),n(3),v("input-error",t.formService.isControlInvalid(t.form,"lastName")),n(),g(t.formService.isControlInvalid(t.form,"lastName")?12:-1),n(3),v("input-error",t.formService.isControlInvalid(t.form,"email")),n(),g(t.formService.isControlInvalid(t.form,"email")?16:-1),n(4),v("input-error",t.formService.isNestedControlInvalid(t.form,"passwords","password")),n(),g(t.formService.isNestedControlInvalid(t.form,"passwords","password")?21:-1),n(3),v("input-error",t.formService.isNestedControlInvalid(t.form,"passwords","repass")),n(),g(t.formService.isNestedControlInvalid(t.form,"passwords","repass")?25:-1),n(3),g(((o=t.form.get("picture"))==null?null:o.value)!==""?28:29)}},dependencies:[Y,J,U,D,R,$,z,Z,B],styles:["#rightside[_ngcontent-%COMP%]{margin-top:3%;overflow-y:auto;overflow-x:hidden;height:100%;display:flex;justify-content:center;align-items:flex-start}.edit-profile-card[_ngcontent-%COMP%]{background-color:#252525;border-radius:8px;padding:2rem;width:100%;max-width:600px;box-shadow:0 0 10px #00ffcc1a;display:flex;flex-direction:column}.edit-profile-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{text-align:center;color:#0fc;margin-bottom:2rem}.edit-profile-form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.edit-profile-form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-top:1rem;margin-bottom:.3rem;font-weight:700;color:#0fc}.edit-profile-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.7rem;border:2px solid transparent;border-radius:4px;background-color:#1e1e1e;color:#fff;outline:none;font-size:1rem;transition:background-color .2s ease}.edit-profile-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{background-color:#2a2a2a}.edit-profile-form[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{padding:.4rem;color:#0fc}.edit-profile-form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:2rem;padding:.75rem;background-color:#0fc;color:#000;font-weight:700;border:none;border-radius:4px;cursor:pointer;transition:background-color .2s ease}.back-button[_ngcontent-%COMP%]{color:red!important}.edit-profile-form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#00e6b8}.input-error[_ngcontent-%COMP%]{border-left-color:red!important}.error[_ngcontent-%COMP%]{text-align:left;border-radius:.5em;color:red;padding-top:0;font-weight:700;font-size:.875rem;margin-top:.25rem}"]})};export{Q as Edit};
