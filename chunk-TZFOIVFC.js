import{a as D,b as d,c as j,d as R,e as B,f as J,h as z,i as Z,j as $,k as H,l as Y,m as K}from"./chunk-YBQB6ODU.js";import{a as U}from"./chunk-SAMSQOYA.js";import"./chunk-M6DMS4UB.js";import"./chunk-WJ5ZAXFD.js";import{c as A,i as L}from"./chunk-P6VS5ELV.js";import{Ab as C,Bb as l,Cb as v,La as k,Na as n,Ra as G,Xa as q,a as y,b as M,cc as V,d as I,da as T,ia as h,lb as p,mb as f,oa as N,pa as P,qb as x,rb as a,sb as s,tb as g,u as w,w as O,wb as F,xb as _,zb as u}from"./chunk-ZL2HHINX.js";var b=class o{formBuilder=h(Y);httpClient=h(A);CLOUD_NAME="dsqegonee";UPLOAD_PRESET="my_unsigned_preset";createProfileForm(){let r=localStorage.getItem("user"),e=r?JSON.parse(r):"",t=e.email,i=e.firstName,c=e.lastName,m=e.picture;return this.formBuilder.group({firstName:[i,[d.required,d.minLength(4)]],lastName:[c,[d.required,d.minLength(4)]],email:[t,[d.required,d.pattern(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)]],passwords:this.formBuilder.group({password:["",[d.required,d.minLength(5),d.pattern(/^[a-zA-Z0-9]+$/)]],repass:["",[d.required]]},{validators:this.passwordMatchValidator}),picture:[m]})}uploadPicture(r){let e=new FormData;return e.append("file",r),e.append("upload_preset",this.UPLOAD_PRESET),this.httpClient.post(`https://api.cloudinary.com/v1_1/${this.CLOUD_NAME}/image/upload`,e).pipe(O(t=>({url:t.secure_url,publicId:t.public_id})))}getNestedControl(r,e,t){return r.get(e)?.get(t)}passwordMatchValidator(r){let e=r.get("password"),t=r.get("repass");return!e||!t?null:e.value!==t.value?(t.setErrors({passwordMismatch:!0}),{passwordMismatch:!0}):(t.hasError("passwordMismatch")&&t.setErrors(null),null)}getControl(r,e){return r.get(e)}isControlInvalid(r,e){let t=this.getControl(r,e);return t?.invalid&&(t?.dirty||t?.touched)||!1}isNestedControlInvalid(r,e,t){let i=this.getNestedControl(r,e,t);return i?.invalid&&(i?.dirty||i?.touched)||!1}getFirstNameErrorMessage(r){let e=this.getControl(r,"firstName");return e?.errors?.required?"First name is required!":e?.errors?.minlength?"First Name should have at least 4 symbols!":""}getLastNameErrorMessage(r){let e=this.getControl(r,"lastName");return e?.errors?.required?"Last name is required!":e?.errors?.minlength?"Last Name should have at least 4 symbols!":""}getEmailErrorMessage(r){let e=this.getControl(r,"email");return e?.errors?.required?"Email is required!":e?.errors?.pattern?"Email should be a valid email address!":""}getPasswordErrorMessage(r,e=!1){let t=e?this.getNestedControl(r,"passwords","password"):this.getControl(r,"password");return t?.errors?.required?"Password is required!":t?.errors?.minlength?"Password should be at least 5 characters!":t?.errors?.pattern?"Password should contain only English letters and digits!":e&&r.get("passwords")?.errors?.passwordMismatch?"Passwords do not match!":""}getRePasswordErrorMessage(r){let e=this.getNestedControl(r,"passwords","repass"),t=r.get("passwords");return e?.errors?.required?"Repeat Password is required!":t?.errors?.passwordMismatch?"Passwords do not match!":""}markFormTouched(r){Object.keys(r.controls).forEach(e=>{let t=r.get(e);t instanceof B?Object.keys(t.controls).forEach(i=>{t.get(i)?.markAsTouched()}):t?.markAsTouched()})}isFormInvalid(r){return r.invalid}getProfileFormValue(r){let{firstName:e,lastName:t,email:i,picture:c}=r.value,{password:m,repass:S}=r.value.passwords;return{firstName:e,lastName:t,email:i,picture:c,password:m,repass:S}}static \u0275fac=function(e){return new(e||o)};static \u0275prov=T({token:o,factory:o.\u0275fac,providedIn:"root"})};function X(o,r){if(o&1&&(a(0,"h1",2),l(1),s()),o&2){let e=u();n(),v(e.errorToShow.message)}}function ee(o,r){if(o&1&&(a(0,"p",6),l(1),s()),o&2){let e=u();n(),v(e.formService.getFirstNameErrorMessage(e.form))}}function te(o,r){if(o&1&&(a(0,"p",6),l(1),s()),o&2){let e=u();n(),v(e.formService.getLastNameErrorMessage(e.form))}}function re(o,r){if(o&1&&(a(0,"p",6),l(1),s()),o&2){let e=u();n(),v(e.formService.getEmailErrorMessage(e.form))}}function oe(o,r){if(o&1&&(a(0,"p",6),l(1),s()),o&2){let e=u();n(),v(e.formService.getPasswordErrorMessage(e.form,!0))}}function ie(o,r){if(o&1&&(a(0,"p",6),l(1),s()),o&2){let e=u();n(),v(e.formService.getRePasswordErrorMessage(e.form))}}function ne(o,r){if(o&1){let e=F();g(0,"img",21),a(1,"button",22),_("click",function(){N(e);let i=u();return P(i.removePicture())}),l(2,"Remove Picture"),s()}if(o&2){let e,t=u();x("src",(e=t.form.get("picture"))==null?null:e.value,k)}}function ae(o,r){if(o&1){let e=F();a(0,"input",23),_("change",function(i){N(e);let c=u();return P(c.onFileSelected(i))}),s()}}var Q=class o{constructor(r){this.location=r;this.form=this.formService.createProfileForm()}formService=h(b);authService=h(U);router=h(L);errorToShow=null;selectedFile=null;isUploading=!1;user;form;onFileSelected(r){let e=r.target.files?.[0];if(!e)return;let t=new FileReader;t.onload=()=>{this.form.get("picture")?.setValue(t.result)},t.readAsDataURL(e),this.selectedFile=e}removePicture(){this.form.get("picture")?.setValue(""),this.selectedFile=null;let r=localStorage.getItem("user");if(r){let e=JSON.parse(r);e.picture="",e.pictureId="",localStorage.setItem("user",JSON.stringify(e))}}onSubmit(){return I(this,null,function*(){if(this.isUploading){alert("Please wait until your picture has been uploaded");return}if(this.formService.isFormInvalid(this.form)){this.formService.markFormTouched(this.form);return}let r=localStorage.getItem("user");if(!r){alert("Your user information is missing, please contact support");return}let e=JSON.parse(r),t=e.email,i=this.form.get("picture")?.value;try{if(i||(yield w(this.authService.removePicture(t)),e.picture="",e.pictureId="",localStorage.setItem("user",JSON.stringify(e))),this.selectedFile){let E=yield w(this.formService.uploadPicture(this.selectedFile));this.form.get("picture")?.setValue(E.url),e.picture=E.url,e.pictureId=E.publicId,localStorage.setItem("user",JSON.stringify(e))}let c=this.formService.getProfileFormValue(this.form),m=M(y({},c),{oldEmail:t,pictureId:e.pictureId}),S=yield w(this.authService.updateUserInfo(m));this.user=S,localStorage.setItem("user",JSON.stringify(S)),this.router.navigate(["/profile"])}catch(c){console.error("Update failed:",c);let m=c.error?.errors;typeof m=="string"?this.errorToShow={message:m}:Array.isArray(m)?this.errorToShow={message:m.join(", ")}:typeof m=="object"&&m!==null?this.errorToShow={message:Object.values(m).join(", ")}:this.errorToShow={message:"Unexpected error occurred"},this.formService.markFormTouched(this.form)}})}goBack(){this.location.back()}static \u0275fac=function(e){return new(e||o)(G(V))};static \u0275cmp=q({type:o,selectors:[["app-edit"]],decls:36,vars:18,consts:[["id","rightside"],[1,"edit-profile-card"],[1,"h1errorToShow"],[1,"edit-profile-form",3,"ngSubmit","formGroup"],["for","firstName"],["type","text","id","firstName","formControlName","firstName","value","\u0418\u0432\u0430\u043D","required",""],[1,"error"],["for","lastName"],["type","text","id","lastName","formControlName","lastName","value","\u0418\u0432\u0430\u043D\u043E\u0432","required",""],["for","email"],["type","email","id","email","formControlName","email","value","ivan@example.com","required",""],["formGroupName","passwords",1,"edit-profile-form"],["for","password"],["type","password","id","password","formControlName","password"],["for","repass"],["type","password","id","repass","formControlName","repass"],["for","pictureFile"],["type","file","id","pictureFile","accept","image/*"],["type","hidden","formControlName","picture"],["type","submit"],[1,"back-button",3,"click"],["alt","Profile preview",1,"preview-img",3,"src"],["type","button",3,"click"],["type","file","id","pictureFile","accept","image/*",3,"change"]],template:function(e,t){if(e&1&&(a(0,"div",0)(1,"div",1)(2,"h1"),l(3,"Edit Profile"),s(),p(4,X,2,1,"h1",2),a(5,"form",3),_("ngSubmit",function(){return t.onSubmit()}),a(6,"label",4),l(7,"First name"),s(),g(8,"input",5),p(9,ee,2,1,"p",6),a(10,"label",7),l(11,"Last Name"),s(),g(12,"input",8),p(13,te,2,1,"p",6),a(14,"label",9),l(15,"Email"),s(),g(16,"input",10),p(17,re,2,1,"p",6),a(18,"div",11)(19,"label",12),l(20,"New Password"),s(),g(21,"input",13),p(22,oe,2,1,"p",6),a(23,"label",14),l(24,"Repeat New Password"),s(),g(25,"input",15),p(26,ie,2,1,"p",6),s(),a(27,"label",16),l(28,"Profile Picture"),s(),p(29,ne,3,1)(30,ae,1,0,"input",17),g(31,"input",18),a(32,"button",19),l(33,"Save The Changes"),s(),a(34,"button",20),_("click",function(c){return t.goBack(),c.preventDefault()}),l(35,"CANCEL"),s()()()()),e&2){let i;n(4),f(t.errorToShow!=null?4:-1),n(),x("formGroup",t.form),n(3),C("input-error",t.formService.isControlInvalid(t.form,"firstName")),n(),f(t.formService.isControlInvalid(t.form,"firstName")?9:-1),n(3),C("input-error",t.formService.isControlInvalid(t.form,"lastName")),n(),f(t.formService.isControlInvalid(t.form,"lastName")?13:-1),n(3),C("input-error",t.formService.isControlInvalid(t.form,"email")),n(),f(t.formService.isControlInvalid(t.form,"email")?17:-1),n(4),C("input-error",t.formService.isNestedControlInvalid(t.form,"passwords","password")),n(),f(t.formService.isNestedControlInvalid(t.form,"passwords","password")?22:-1),n(3),C("input-error",t.formService.isNestedControlInvalid(t.form,"passwords","repass")),n(),f(t.formService.isNestedControlInvalid(t.form,"passwords","repass")?26:-1),n(3),f(((i=t.form.get("picture"))==null?null:i.value)!==""?29:30)}},dependencies:[K,J,D,j,R,H,z,$,Z],styles:["#rightside[_ngcontent-%COMP%]{margin-top:3%;overflow-y:auto;overflow-x:hidden;height:100%;display:flex;justify-content:center;align-items:flex-start}.edit-profile-card[_ngcontent-%COMP%]{background-color:#252525;border-radius:8px;padding:2rem;width:100%;max-width:600px;box-shadow:0 0 10px #00ffcc1a;display:flex;flex-direction:column}.edit-profile-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{text-align:center;color:#0fc;margin-bottom:2rem}.edit-profile-form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.edit-profile-form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-top:1rem;margin-bottom:.3rem;font-weight:700;color:#0fc}.edit-profile-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.7rem;border:2px solid transparent;border-radius:4px;background-color:#1e1e1e;color:#fff;outline:none;font-size:1rem;transition:background-color .2s ease}.edit-profile-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{background-color:#2a2a2a}.edit-profile-form[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{padding:.4rem;color:#0fc}.edit-profile-form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:2rem;padding:.75rem;background-color:#0fc;color:#000;font-weight:700;border:none;border-radius:4px;cursor:pointer;transition:background-color .2s ease}.back-button[_ngcontent-%COMP%]{color:red!important}.edit-profile-form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#00e6b8}.input-error[_ngcontent-%COMP%]{border-left-color:red!important}.error[_ngcontent-%COMP%]{text-align:left;border-radius:.5em;color:red;padding-top:0;font-weight:700;font-size:.875rem;margin-top:.25rem}.edit-profile-card[_ngcontent-%COMP%] > .h1errorToShow[_ngcontent-%COMP%]{color:#db7093}"]})};export{Q as Edit};
