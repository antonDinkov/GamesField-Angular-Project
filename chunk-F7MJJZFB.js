import{a as I,b as d,c as O,d as G,e as k,f as q,h as T,i as L,j as U,k as A,l as D,m as V}from"./chunk-3PEPFQZM.js";import{a as j}from"./chunk-RDBCJRFJ.js";import{A as N,B as P,J as u,K as f,O as F,P as n,Q as a,R as p,V as C,X as g,Y as v,Z as l,_ as h,a as _,b as E,e as S,k as w,ka as M,o as c,pa as x,ua as y,y as i}from"./chunk-4S46JJTL.js";var b=class o{formBuilder=c(D);httpClient=c(x);CLOUD_NAME="dsqegonee";UPLOAD_PRESET="my_unsigned_preset";createProfileForm(){let t=localStorage.getItem("user"),e=t?JSON.parse(t):"",r=e.email,s=e.firstName,m=e.lastName;return this.formBuilder.group({firstName:[s,[d.required,d.minLength(4)]],lastName:[m,[d.required,d.minLength(4)]],email:[r,[d.required,d.pattern(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/)]],passwords:this.formBuilder.group({password:["",[d.required,d.minLength(5),d.pattern(/^[a-zA-Z0-9]+$/)]],repass:["",[d.required]]},{validators:this.passwordMatchValidator}),picture:[""]})}uploadPicture(t){let e=new FormData;return e.append("file",t),e.append("upload_preset",this.UPLOAD_PRESET),this.httpClient.post(`https://api.cloudinary.com/v1_1/${this.CLOUD_NAME}/image/upload`,e).pipe(S(r=>r.secure_url))}getNestedControl(t,e,r){return t.get(e)?.get(r)}passwordMatchValidator(t){let e=t.get("password"),r=t.get("repass");return!e||!r?null:e.value!==r.value?(r.setErrors({passwordMismatch:!0}),{passwordMismatch:!0}):(r.hasError("passwordMismatch")&&r.setErrors(null),null)}getControl(t,e){return t.get(e)}isControlInvalid(t,e){let r=this.getControl(t,e);return r?.invalid&&(r?.dirty||r?.touched)||!1}isNestedControlInvalid(t,e,r){let s=this.getNestedControl(t,e,r);return s?.invalid&&(s?.dirty||s?.touched)||!1}getFirstNameErrorMessage(t){let e=this.getControl(t,"firstName");return e?.errors?.required?"First name is required!":e?.errors?.minlength?"First Name should have at least 4 symbols!":""}getLastNameErrorMessage(t){let e=this.getControl(t,"lastName");return e?.errors?.required?"Last name is required!":e?.errors?.minlength?"Last Name should have at least 4 symbols!":""}getEmailErrorMessage(t){let e=this.getControl(t,"email");return e?.errors?.required?"Email is required!":e?.errors?.pattern?"Email should be a valid email address!":""}getPasswordErrorMessage(t,e=!1){let r=e?this.getNestedControl(t,"passwords","password"):this.getControl(t,"password");return r?.errors?.required?"Password is required!":r?.errors?.minlength?"Password should be at least 5 characters!":r?.errors?.pattern?"Password should contain only English letters and digits!":e&&t.get("passwords")?.errors?.passwordMismatch?"Passwords do not match!":""}getRePasswordErrorMessage(t){let e=this.getNestedControl(t,"passwords","repass"),r=t.get("passwords");return e?.errors?.required?"Repeat Password is required!":r?.errors?.passwordMismatch?"Passwords do not match!":""}markFormTouched(t){Object.keys(t.controls).forEach(e=>{let r=t.get(e);r instanceof k?Object.keys(r.controls).forEach(s=>{r.get(s)?.markAsTouched()}):r?.markAsTouched()})}isFormInvalid(t){return t.invalid}getProfileFormValue(t){let{firstName:e,lastName:r,email:s,picture:m}=t.value,{password:z,repass:B}=t.value.passwords;return{firstName:e,lastName:r,email:s,picture:m,password:z,repass:B}}static \u0275fac=function(e){return new(e||o)};static \u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"})};function J(o,t){if(o&1&&(n(0,"p",5),l(1),a()),o&2){let e=g();i(),h(e.formService.getFirstNameErrorMessage(e.form))}}function $(o,t){if(o&1&&(n(0,"p",5),l(1),a()),o&2){let e=g();i(),h(e.formService.getLastNameErrorMessage(e.form))}}function H(o,t){if(o&1&&(n(0,"p",5),l(1),a()),o&2){let e=g();i(),h(e.formService.getEmailErrorMessage(e.form))}}function K(o,t){if(o&1&&(n(0,"p",5),l(1),a()),o&2){let e=g();i(),h(e.formService.getPasswordErrorMessage(e.form,!0))}}function Q(o,t){if(o&1&&(n(0,"p",5),l(1),a()),o&2){let e=g();i(),h(e.formService.getRePasswordErrorMessage(e.form))}}var R=class o{constructor(t){this.location=t;this.form=this.formService.createProfileForm()}formService=c(b);authService=c(j);router=c(y);isUploading=!1;user;form;onSubmit(){if(this.isUploading){alert("Please wait until your picture has been uploaded");return}if(this.formService.isFormInvalid(this.form)){this.formService.markFormTouched(this.form);return}let t=localStorage.getItem("user"),e="";t&&(e=JSON.parse(t).email);let r=this.formService.getProfileFormValue(this.form),s=E(_({},r),{oldEmail:e});this.authService.updateUserInfo(s).subscribe({next:m=>{this.user=m,localStorage.setItem("user",JSON.stringify(this.user)),this.router.navigate(["/profile"])},error:m=>{console.error("Update failed:",m),this.formService.markFormTouched(this.form)}})}goBack(){this.location.back()}onFileSelected(t){let e=t.target.files?.[0];e&&(this.isUploading=!0,this.formService.uploadPicture(e).subscribe({next:r=>{this.form.get("picture")?.setValue(r),this.isUploading=!1},error:r=>{console.error("Upload error:",r),this.isUploading=!1}}))}static \u0275fac=function(e){return new(e||o)(N(M))};static \u0275cmp=P({type:o,selectors:[["app-edit"]],decls:34,vars:16,consts:[["id","rightside"],[1,"edit-profile-card"],[1,"edit-profile-form",3,"ngSubmit","formGroup"],["for","firstName"],["type","text","id","firstName","formControlName","firstName","value","\u0418\u0432\u0430\u043D","required",""],[1,"error"],["for","lastName"],["type","text","id","lastName","formControlName","lastName","value","\u0418\u0432\u0430\u043D\u043E\u0432","required",""],["for","email"],["type","email","id","email","formControlName","email","value","ivan@example.com","required",""],["formGroupName","passwords",1,"edit-profile-form"],["for","password"],["type","password","id","password","formControlName","password"],["for","repass"],["type","password","id","repass","formControlName","repass"],["for","pictureFile"],["type","file","id","pictureFile","accept","image/*",3,"change"],["type","hidden","formControlName","picture"],["type","submit"],[1,"back-button",3,"click"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"div",1)(2,"h1"),l(3,"Edit Profile"),a(),n(4,"form",2),C("ngSubmit",function(){return r.onSubmit()}),n(5,"label",3),l(6,"First name"),a(),p(7,"input",4),u(8,J,2,1,"p",5),n(9,"label",6),l(10,"Last Name"),a(),p(11,"input",7),u(12,$,2,1,"p",5),n(13,"label",8),l(14,"Email"),a(),p(15,"input",9),u(16,H,2,1,"p",5),n(17,"div",10)(18,"label",11),l(19,"New Password"),a(),p(20,"input",12),u(21,K,2,1,"p",5),n(22,"label",13),l(23,"Repeat New Password"),a(),p(24,"input",14),u(25,Q,2,1,"p",5),a(),n(26,"label",15),l(27,"Profile Picture"),a(),n(28,"input",16),C("change",function(m){return r.onFileSelected(m)}),a(),p(29,"input",17),n(30,"button",18),l(31,"Save The Changes"),a(),n(32,"button",19),C("click",function(m){return r.goBack(),m.preventDefault()}),l(33,"CANCEL"),a()()()()),e&2&&(i(4),F("formGroup",r.form),i(3),v("input-error",r.formService.isControlInvalid(r.form,"firstName")),i(),f(r.formService.isControlInvalid(r.form,"firstName")?8:-1),i(3),v("input-error",r.formService.isControlInvalid(r.form,"lastName")),i(),f(r.formService.isControlInvalid(r.form,"lastName")?12:-1),i(3),v("input-error",r.formService.isControlInvalid(r.form,"email")),i(),f(r.formService.isControlInvalid(r.form,"email")?16:-1),i(4),v("input-error",r.formService.isNestedControlInvalid(r.form,"passwords","password")),i(),f(r.formService.isNestedControlInvalid(r.form,"passwords","password")?21:-1),i(3),v("input-error",r.formService.isNestedControlInvalid(r.form,"passwords","repass")),i(),f(r.formService.isNestedControlInvalid(r.form,"passwords","repass")?25:-1))},dependencies:[V,q,I,O,G,A,T,U,L],styles:["#rightside[_ngcontent-%COMP%]{margin-top:3%;overflow-y:auto;overflow-x:hidden;height:100%;display:flex;justify-content:center;align-items:flex-start}.edit-profile-card[_ngcontent-%COMP%]{background-color:#252525;border-radius:8px;padding:2rem;width:100%;max-width:600px;box-shadow:0 0 10px #00ffcc1a;display:flex;flex-direction:column}.edit-profile-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{text-align:center;color:#0fc;margin-bottom:2rem}.edit-profile-form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.edit-profile-form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-top:1rem;margin-bottom:.3rem;font-weight:700;color:#0fc}.edit-profile-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.7rem;border:2px solid transparent;border-radius:4px;background-color:#1e1e1e;color:#fff;outline:none;font-size:1rem;transition:background-color .2s ease}.edit-profile-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{background-color:#2a2a2a}.edit-profile-form[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{padding:.4rem;color:#0fc}.edit-profile-form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:2rem;padding:.75rem;background-color:#0fc;color:#000;font-weight:700;border:none;border-radius:4px;cursor:pointer;transition:background-color .2s ease}.back-button[_ngcontent-%COMP%]{color:red!important}.edit-profile-form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#00e6b8}.input-error[_ngcontent-%COMP%]{border-left-color:red!important}.error[_ngcontent-%COMP%]{text-align:left;border-radius:.5em;color:red;padding-top:0;font-weight:700;font-size:.875rem;margin-top:.25rem}"]})};export{R as Edit};
